1. Create a user for automation (`qradar_usr`)

   Head to =>>> System > User Manager > Users
   
   <img width="1150" height="418" alt="image" src="https://github.com/user-attachments/assets/6383b00a-a074-4f71-844c-1745e2018894" />

   Input the username and password for the new user and click on save at the bottom left.

2. Enable SSH access permission for `qradar_usr`

   After saving, click the pencil icon (edit) next to the newly created user

   <img width="1137" height="36" alt="image" src="https://github.com/user-attachments/assets/5e2baf3a-290b-4ec0-8800-5d8807691f12" />
   
   Locate the Effective Privileges and then click the add button
   
   <img width="1143" height="165" alt="image" src="https://github.com/user-attachments/assets/3537622b-72f7-480b-a0f2-e3c42222f84a" />

   Locate and select the `User - System: Shell account access` permission and then click save.
   
   <img width="701" height="461" alt="image" src="https://github.com/user-attachments/assets/8126dd12-aa16-4ffe-a8d1-51678b1daf6d" />

3. Provision SSH Key for Authentication

   Locate the Key section in the System > User Manager > Users > Edit page

   <img width="1145" height="231" alt="image" src="https://github.com/user-attachments/assets/48d7059b-5bab-4d89-b10b-d904f01f5a31" />

   Copy you QRadar public key and paste it in the box and then click on save.

   NB: you can find yiour QRadar public key at `~/.ssh/id_rsa.pub` (you can create a new keypair if you would like)

4. Configure an Alias in pfSense

   Head to =>>> Firewall > Aliases > IP

   <img width="1153" height="311" alt="image" src="https://github.com/user-attachments/assets/7ab7e381-e921-4d91-b2bc-e6e8e7b45dd7" />

   Click the add button and create a new alias `qradar_blocklist`

   <img width="1155" height="534" alt="image" src="https://github.com/user-attachments/assets/f9f3dec4-f808-4a2b-93b1-e787075800c1" />

   click on save.

   <img width="1157" height="169" alt="image" src="https://github.com/user-attachments/assets/579549a2-9874-47c8-bef6-b34573d9c0f1" />

   then click on Apply Changes for it to take effect.
   
6. Add a Firewall Block Rule Using the Alias

   Head to =>>> Firewall > Rules > WAN

   <img width="1159" height="379" alt="image" src="https://github.com/user-attachments/assets/03ddd729-2a93-4c7b-bb91-c3bc68a9ae42" />

   click the add button to create your new firewall rule.
   
   <img width="1160" height="1187" alt="image" src="https://github.com/user-attachments/assets/33cee0be-7426-4c71-90df-9a7727cf8e7e" />

   NB: you can tune to your specific needs

   Click save and then click Apply Changes for your changes to be deployed.

   <img width="1149" height="420" alt="image" src="https://github.com/user-attachments/assets/c0a4844f-0a62-439c-86c9-3b6164877b99" />

7. Install _sudo_ Package with Package Manager

   Head to =>>> System > Package Manager > Available Packages

   Locate the `sudo` package and click on install
   
   <img width="1148" height="419" alt="image" src="https://github.com/user-attachments/assets/79fc9ddd-c8da-44e0-96c1-ba73f8e99b9f" />

   <img width="1149" height="526" alt="image" src="https://github.com/user-attachments/assets/ee16f7c8-8c0c-413b-b587-c48e7e81bc14" />

   This will allow us to run sudo command in our custom action script.

8. Edit _sudoers_ file for restricted privilege escalation

   While logged in as root in your pfSense cli, run the `visudo` command and add the following line to the bottom of the file then save.

   ```text
   qradar_usr ALL=(ALL) NOPASSWD: /sbin/pfctl
   ```
   This line allows `qradar_usr` to run the `pfctl` command as root without being asked for a password â€” but only that command (not other root commands).

   <img width="586" height="111" alt="image" src="https://github.com/user-attachments/assets/70965a00-e88c-472a-b127-da200bb8d289" />

   save the file with `:wq` 
