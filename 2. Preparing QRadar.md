### 1. Test Connection

  SSH into pfSense `10.10.1.1` from the QRadar console cli using the following command:
  
  ``` bash
  ssh -i ~/.ssh/id_rsa qradar_usr@10.10.1.1
  ```
  
  I got the following error message:
  
  ```text
  [root@qracon ~]# ssh -i ~/.ssh/id_rsa.pub qradar_usr@10.10.1.1
  No ED25519 host key is known for 10.10.1.1 and you have requested strict checking.
  Host key verification failed.
  ```
  
  This means QRadar does not trust pfSense's SSH host key yet. I fixed that by running the following command:
  
  ``` bash
  ssh-keyscan -t ed25519 10.10.1.1 >> ~/.ssh/known_hosts
  ```
  
  <img width="630" height="58" alt="image" src="https://github.com/user-attachments/assets/97466524-342b-49ce-8367-c69aabe1dbe8" />
  
  The output above shows the command ran successfully.
  
  I can try to ssh again now and it should work fine.
  
  <img width="686" height="54" alt="image" src="https://github.com/user-attachments/assets/4a7b0762-dbcf-4ee1-abe7-57897757c0ca" />

  Due to the way custom actions are processed on QRadar.

  _A script can run only from inside the jail environment so that it does not interfere with the QRadar run environment. All file access during custom action execution is relative to the `/opt/qradar/bin/ca_jail/` directory._

  I need to create a copy of the private key in the `customactionuser's` home directory

  ```bash
  mkdir -p /opt/qradar/bin/ca_jail/home/customactionuser/.ssh
  cp /root/.ssh/id_rsa /opt/qradar/bin/ca_jail/home/customactionuser/.ssh/
  chown -R customactionuser:customactionuser /opt/qradar/bin/ca_jail/home/customactionuser/.ssh
  chmod 700 /opt/qradar/bin/ca_jail/home/customactionuser/.ssh
  chmod 600 /opt/qradar/bin/ca_jail/home/customactionuser/.ssh/id_rsa
  ```
  
  The private key path will be referenced in the `block_ip_pfsense.sh` script
  
  Now that ssh connection is working fine, and the private key is setup in the right directory I can move on to testing the command to add ip to block list and remove ip from block list.

### 2. Manual test for adding ip address to blocklist

  I ran the following command to add `1.2.3.4` to the ip block list:

  ```bash
  sudo pfctl -t qradar_blocklist -T add 1.2.3.4
  ```

  <img width="887" height="51" alt="image" src="https://github.com/user-attachments/assets/7ba4c6b1-9ed8-4ff9-9340-01d8e933580a" />

  Success! I can confirm the content of the blocklist with the following command:

  ```bash
  sudo pfctl -t qradar_blocklist -T show
  ```

  <img width="851" height="53" alt="image" src="https://github.com/user-attachments/assets/266cc6d6-4882-4438-b698-34d06728555a" />

### 3. Manual test for removing ip address from blocklist
  I ran the following command to  remove `1.2.3.4` from the block list:

  ```bash
  sudo pfctl -t qradar_blocklist -T delete 1.2.3.4
  ```

  <img width="900" height="83" alt="image" src="https://github.com/user-attachments/assets/f28a9dcb-73de-4d85-b24e-e0c0429b6f5a" />

  Success! I see that the ip `1.2.3.4` was removed from the block list.

### References
https://www.ibm.com/docs/en/qsip/7.5?topic=tasks-adding-custom-actions
