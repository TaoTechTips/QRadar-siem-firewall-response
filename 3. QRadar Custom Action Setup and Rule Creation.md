### Phew! We made it!

It is about to get interesting.

### 1. Create Custom Action 

  Login to the QRadar UI. 

  Navigate to Admin > Custom Actions > Define Actions

  <img width="136" height="154" alt="image" src="https://github.com/user-attachments/assets/2e40c122-d987-435b-97fb-d1ce6381ba07" />

  Click on Add to create a new Custom Action

  <img width="1018" height="238" alt="image" src="https://github.com/user-attachments/assets/0e346805-dd29-46cd-a12a-7b484d9e6c40" />

  <img width="537" height="591" alt="image" src="https://github.com/user-attachments/assets/c8edf5f6-b674-46bd-aa25-10e4af1c172e" />

  Give your custom action a name and description.

  I set the interpreter to Bash and uploaded the script. (`block_ip_pfsense.sh`)

  Scroll down

  I created a new Script Parameter (`Source IP`)
  Selected Network Event Property and choose the `sourceip` property since I am using the source ip of the offense as the malicious ip.

  <img width="528" height="594" alt="image" src="https://github.com/user-attachments/assets/ba4004e7-75f7-4973-86e2-394ef59c025b" />  

  <img width="490" height="102" alt="image" src="https://github.com/user-attachments/assets/9a185c50-03e0-4263-a32e-3cf348e792b8" />

  Click on the `Save` button.

  <img width="402" height="142" alt="image" src="https://github.com/user-attachments/assets/b6fcf599-ad16-44be-b40a-212cf4569e95" />

  Now, I will head to the `Admin` tab to deploy changes.

  `Admin` > `Deploy Changes`

  <img width="1665" height="576" alt="image" src="https://github.com/user-attachments/assets/4dd9e67e-b905-4e04-a525-b56bb0c5f085" />

  After the changes have been deployed, the custom action is now ready to be used in a rule response.

### 2. Create QRadar Rule `Potential Brute Force Attack`

  Head to Offenses > Rules on QRadar

  Click Actions > New Event Rule
  
  <img width="1628" height="490" alt="image" src="https://github.com/user-attachments/assets/07ecb063-122d-4bd6-959c-a4ebb0cb16e1" />

  I will create a rule test to detect 10 failed login attempts within 5 minutes. 

  <img width="789" height="750" alt="image" src="https://github.com/user-attachments/assets/74b11f00-7e2a-4295-93f7-591e00c9c006" />

  Click `Next` to go to the Rule Action tab

  <img width="793" height="752" alt="image" src="https://github.com/user-attachments/assets/ff11cedb-2539-4ba7-923d-c166374f1ca6" />

  Scroll down and ensure `Enable this rule if you want it to begin watching events right away.` is checked. 

  Click `Finish`

  This rule will create an offense when 10 or more failed login attempts occur within 5 minutes and when the context is remote to local.
  _NB: based on my network hierarchy configuration on QRadar, only the the 10.10.1.0/24 network is considered local_

### References 
https://www.ibm.com/docs/en/qsip/7.5?topic=tasks-adding-custom-actions
